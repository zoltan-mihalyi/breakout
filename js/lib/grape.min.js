/*! Grape.js JavaScript game engine | (c) 2013 Zoltan Mihalyi. | https://github.com/zoltan-mihalyi/grape/blob/master/MIT-LICENSE.txt*/

(function(e){var t,n;(function(){var e={},i={},r=Object.prototype.hasOwnProperty,o=function(e,t){return r.call(e,t)};n=function(t,n,r){if(o(e,t)||o(i,t))throw"Already defined: "+t;i[t]=[n,r]};var s=function(t){var n,r,a,u;if(!o(e,t)&&o(i,t)){for(n=i[t],r=n[0],a=[],u=0;r.length>u;++u)s(r[u]),a[u]=e[r[u]];e[t]=n[1].apply({},a)}};t=function(t,n){s(t),n&&n(e[t])}})(),n("../js/grape/dependency",function(){}),n("core/logger",[],function(){return{log:"undefined"!=typeof console&&console.log?function(){return Function.prototype.apply.call(console.log,console,arguments)}:function(){},warning:"undefined"!=typeof console&&console.warn?function(){return Function.prototype.apply.call(console.warn,console,arguments)}:function(){},error:function(e){throw e}}}),n("utils/trim",[],function(){return function(e){return e.replace(/^\s+|\s+$/g,"")}}),n("utils/format",[],function(){return function(e,t){var n,i;if(t&&t.constructor===Object||t instanceof Array||(t=Array.prototype.slice.call(arguments,1)),t instanceof Array){for(i={},n=t.length;--n>=0;)i["%"+(n+1)]=t[n]+"";t=i}for(n in t)t.hasOwnProperty(n)&&(e=e.replace(n,t[n]));return e}}),n("utils/has-prop",[],function(){var e=Object.prototype.hasOwnProperty;return function(t,n){return e.call(t,n)}}),n("utils/unique-generator",[],function(){return{create:function(e){var t=0;return function(){return t++,e+t}}}}),n("core/component",["core/logger","utils/trim","utils/format","utils/has-prop","utils/unique-generator"],function(e,t,n,i,r,o){function s(){}function a(i,r,s,u,c){var l;if("object"==typeof i&&null!==i&&(r=i.inherited,s=i.events||i.eventListeners,u=i.methods,c=i.modifiers,i=i.name),i||(i=M()),"string"==typeof i&&i.match(/^[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)*$/)||e.error(n(w,i)),F[i]!==o&&e.error(n(y,i)),"object"==typeof r&&null!==r&&!(r instanceof Array))return a(i,"",r,s,u);for(null===r||r===o?r=[]:"string"==typeof r&&(r=r.split(",")),l=0;r.length>l;++l)r[l]=t(r[l]),""===r[l]?r.splice(l,1):F[r[l]]===o&&e.error(n(b,r[l]));return"object"!=typeof s&&(s={}),"object"!=typeof u&&(u={}),"object"!=typeof c&&(c={}),v(i,r,s,u,c)}function u(t,i,r,o){var s,a,c,l;if(!i){for(o={},s=0;t.length>s;++s)o[t[s]]=!0;i=[],r={}}for(s=0,a=t.length;a>s;++s)c=t[s],l=F[c].prototype.Component,r[c]?o[c]&&e.error(n(x,c)):(u(l.inherited,i,r,o),i.push(c),r[c]=!0);return i}function c(e,t,n){var r;for(r in e)i(e,r)&&("object"==typeof e[r]?c(e[r],t,n+r+"."):t[n+r]=e[r]);return t}function l(e){return c(e,{},"")}function h(e){var t;for(t in e)if(i(e,t)&&m(e[t]))return!0;return!1}function d(t,i){var r=null;return r=i?function(){e.error(n(C,t))}:Function("",'this["'+t+'"]=function(){}; return this["'+t+'"];').call({}),r.prototype=new s,r.prototype.constructor=r,r}function f(e,t){var n,r,o,s="",a=0;for(n in t)if(i(t,n)){for(s+="case '"+n.replace("'","\\'")+"':\n",r=0,o=t[n].length;o>r;++r)e.prototype["e_"+a+"_"+r]=t[n][r],s+="	this.e_"+a+"_"+r+"(d);\n";s+="	break;\n",a++}""!==s&&(s="switch(e){\n"+s+"}"),e.prototype.Component.dispatch=e.prototype.dispatch=Function("e,d",s+"\nreturn this;"),e.prototype.Component.dispatchWithLocal=Function("e,d",s+"\nthis._localDispatch(e,d);\nreturn this;")}function p(t,r,o,a){var u;for(u in r)i(r,u)&&("Component"===u&&e.error(_),u in s.prototype&&e.error(n(A,u)),o[u]===!1&&e.error(n(E,a[u]+"."+u)),t.prototype[u]=r[u])}function g(e){return e===!1}function m(e){return e===!0}function v(t,r,s,a,c){var v,y,w,b,x,C,E,_,A=u(r),L=h(c),O={},B={},M=[],V={},D={},P={};for(y=0,w=A.length;w>y;++y){O[A[y]]=!0,x=F[A[y]];for(var j in x.prototype.Component.events)i(x.prototype.Component.events,j)&&(B[j]=B[j]||[],B[j].push(x.prototype.Component.events[j]))}s=l(s);for(y in s)i(s,y)&&(B[y]=B[y]||[],B[y].push(s[y]));for(y in B)i(B,y)&&M.push(y);for(v=d(t,L),v.prototype.Component={name:t,inherited:A,inheritedAndMe:A.concat(t),inheritedSet:O,events:s,allEvents:B,eventNames:M,methods:a,modifiers:c},v.prototype.Component.dispatch=v.prototype.dispatch=function(e,t){var n,i,r=B[e];if(r)for(n=0,i=r.length;i>n;++n)r[n].call(this,t);return this},v.prototype.Component.dispatchWithLocal=function(e,t){var n,i,r=B[e];if(r)for(n=0,i=r.length;i>n;++n)r[n].call(this,t);return this._localDispatch(e,t),this},f(v,B),y=0;A.length>y;++y){C=A[y],x=F[C].prototype.Component,E=x.methods,_=x.modifiers;for(b in E)i(E,b)&&(g(V[b])&&e.error(n(S,D[b]+"."+b,C+"."+b)),v.prototype[b]=E[b],P[b]=C);for(b in _)i(_,b)&&(g(_[b])?(V[b]=!1,D[b]=C):m(_[b])&&V[b]===o&&(V[b]=!0,D[b]=C))}p(v,a,V,D);for(y in V)i(V,y)&&m(V[y])&&(v.prototype[y]!==o||m(c[y])||e.error(n(k,D[y]+"."+y)));for(y in c)i(c,y)&&(m(c[y])?v.prototype[y]!==o&&(P[y]?e.error(n(z,t+"."+y,P[y]+"."+y)):e.error(n(T,t+"."+y))):v.prototype[y]===o&&e.error(n(R,t+"."+y)));return F[t]=v,t}var y='Component "%1" already defined!',w='Component name "%1" is not valid. Use alphanumeric characters, and dots as separator! E.g. "BigRedBall" or "2D.Box"',b='Component "%1" is not defined!',x='Component "%1" is twice in the "inherited" list or implied by an other component!',C='Abstract component "%1" cannot be instantiated.',S="Final method %1 cannot be overridden by inheriting %2",E="Final %1 cannot be overridden!",_="Component is a reserved property name.",A='Reserved method name "%1" cannot be overridden.',k="Component does not implement or mark abstract method %1",z="Method %1 cannot be marked abstract because it is inherited from %2",T="Component has an abstract marker on an implemented method: %1",R="Component has a final marker on a non existing method: %1",L="Instance does not have local events",O='Instance does not have local handlers for "%1"',B="Can not call super on non-inherited component.",F={},M=r.create("AnonymusComponent");return s.prototype={dispatch:function(e,t){throw e+t},_localDispatch:function(e,t){var n,i;if(e=this._localEvents[e],e!==o)for(n=0;i=e[n];++n)i.call(this,t)},bind:function(e,t){var n;return this._localEvents||(this._localEvents={},this._localEventNumber=0,this.dispatch=this.Component.dispatchWithLocal),(n=this._localEvents[e])===o&&(n=this._localEvents[e]=[],this.Component.allEvents[e]===o&&(n.subscribe=this._subscribe(e))),n.push(t),++this._localEventNumber,this},unbind:function(t,i){var r,s,a=!1;for(this._localEvents||e.error(L),(s=this._localEvents[t])===o&&(s=[]),r=s.length;--r>=0;)s[r]===i&&(a=!0,1===s.length?(this.Component.allEvents[t]===o&&this._unsubscribe(s.subscribe),delete this._localEvents[t]):s.splice(r,1),0===--this._localEventNumber&&(delete this._localEvents,this.dispatch=this.Component.dispatch));return a||e.error(n(O,t)),this},inherits:function(e){return this.Component.inheritedSet[e]!==o},sup:function(t,n){var i=this;return this.Component.inheritedSet[t]===o&&e.error(B),n=F[t].prototype[n],function(){return n.apply(i,arguments)}},_subscribe:function(e){throw e},_unsubscribe:function(e){throw e}},a.fn=s.prototype,a._reset=function(){F={}},a.get=function(t){return F[t]||e.error(n(b,t))},a}),n("core/canvas",[],function(){return{}}),n("core/settings",[],function(){return{gridSize:64,headless:!1,autoLoad:!0}}),n("core/system",["core/component","core/logger","core/settings","utils/has-prop"],function(e,t,n,i){var r,o="Game already started!",s=0;return e("System",{},{start:function(e,a,u){var c;if(0!==s)return t.error(o),void 0;u=u||{},u.container=e,u.scene=a;for(c in u)i(u,c)&&(n[c]=u[c]);r.dispatch("init"),n.autoLoad?r.dispatch("startLoad"):r.dispatch("start")},frame:function(){this.dispatch("beginFrame"),this.dispatch("handleInput"),this.dispatch("frame"),this.dispatch("physics"),this.dispatch("collision"),this.dispatch("endFrame")}}),r=e.get("System"),r.prototype._subscribe=function(){},r=new r}),n("core/loader",["core/logger","core/system","utils/format","utils/has-prop"],function(e,t,n,i){function r(e){function n(){--d,t.dispatch(),t.dispatch("loadingProcess",{name:"all",percent:100*((h-d-1)/(h-1))}),0===d&&(t.dispatch("loadingComplete","all"),e())}e=e||function(){};var r,o,c,h=1,d=1;for(r in a)if(i(a,r)){u[r]=u[r]||{};for(o in a[r])i(a[r],o)&&(c=a[r][o],u[r][o]?l(r,o,c)():(++h,++d,s[r].loader(o,l(r,o,c,n))))}n()}var o='Type "%1" already added!',s={},a={},u={},c=function(e,n,i,r){var o;for(o=i.length;--o>=0;)e(i[o],n),t.dispatch("resourceProcessed."+r,i[o])},l=function(e,t,n,i){return function(r){i&&(u[e][t]=r),c(s[e].processor,r,n,e),i&&i()}};return t.bind("startLoad",function(){r(function(){t.dispatch("start")})}),{register:function(t,r,a){i(s,t)&&e.error(n(o,t)),s[t]={loader:r,processor:a}},add:function(e,t,n){i(a,e)||(a[e]={}),i(a[e],t)||(a[e][t]=[]),a[e][t].push(n)},loadAll:r}}),n("utils/environment",[],function(){var e={};if("undefined"!=typeof window&&window.document!==void 0)e.browser=!0;else{if("object"!=typeof process||"object"!=typeof process.env)throw"Failed to determine environment!";e.node=!0}return e.canvas="function"==typeof document.createElement("canvas").getContext,e.canvas=!1,e.audio=e.browser?window.Audio!==void 0:!1,e.webAudio=window.webkitAudioContext!==void 0,e}),n("utils/extend",["utils/has-prop"],function(e){return function(t,n){var i;for(i in n)e(n,i)&&(t[i]=n[i])}}),n("core/sprite",["core/logger","core/loader","utils/environment","utils/extend","utils/format","utils/unique-generator"],function(t,n,i,r,o,s,a){function u(e,t,n){var i={left:0,top:0,subimages:1,originX:0,originY:0,width:a,height:a,leftBounding:0,topBounding:0,rightBounding:a,bottomBounding:a};return n===a&&(n=1),"number"==typeof n&&(n={subimages:n}),r(i,n),i.url=e,i.name=t,i}function c(e,i,r){var s;return i===a?(s=d[e])?s:(t.error('Sprite "'+e+'" does not exists.'),null):(e||(e=f()),e.match(/^[a-z0-9][a-zA-Z0-9_]*$/)||t.error(o(l,e)),n.add("sprite",i,d[e]=u(i,e,r)),e)}var l='Sprite name "%1" is invalid. camelCase format is allowed with digits anywhere.',h="Failed to load sprite from URL: %1",d={},f=s.create("anonymus_sprite"),p=function(e,t){var n=t.width,i=t.height;e.width===a&&(e.width=n/e.subimages),e.height===a&&(e.height=i),e.rightBounding===a&&(e.rightBounding=e.width),e.bottomBounding===a&&(e.bottomBounding=e.height)},g=function(){var n;return i.browser?function(e,n){var i=document.createElement("img");i.onerror=function(){t.error(o(h,e))},i.onload=function(){n({width:i.width,height:i.height})},i.src=e}:(n=e("fs"),function(e,i){n.read(e,function(n,r){var s=r;n&&t.error(o(h,e)),i({width:s.width,height:s.height})})})}();return n.register("sprite",g,p),c}),n("utils/dom-utils",["utils/environment","utils/extend"],function(e,t,n){function i(e){return e?e:window.event}var r,o,s,a;return e.browser?("function"==typeof window.addEventListener?(r=function(e,t,n){e.addEventListener(t,n,!1)},o=function(e,t,n){e.removeEventListener(t,n,!1)}):document.attachEvent&&(r=function(e,t,n){e.attachEvent("on"+t,n)},o=function(e,t,n){e.detachEvent("on"+t,n)}),document.documentElement.contains?s=function(e,t){return 9!==t.nodeType&&e!==t&&(e.contains?e.contains(t):!0)}:document.documentElement.compareDocumentPosition&&(s=function(e,t){return!!(16&e.compareDocumentPosition(t)+0)}),a=document.createEvent?function(e,n,i){var r=document.createEvent("HTMLEvents");r.initEvent(n,!0,!0),r.eventName=n,t(r,i||{}),e.dispatchEvent(r)}:function(e,n,i){var r=document.createEventObject();r.eventType=n,r.eventName=n,t(r,i||{}),e.fireEvent("on"+r.eventType,r)},{bind:r,unbind:o,contains:s,getRealEvent:i,fireEvent:a,getTarget:function(e){return e?e.target?e.target:e.srcElement:window.event.srcElement},getKeyCode:function(e){return e=i(e),e.which!==n?e.which:e.keyCode},preventDefault:function(e){e=i(e),e.preventDefault?e.preventDefault():e.returnValue=!1},createStyle:function(e){var t=document.createElement("style");return t.type="text/css",t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(t),t},hasClass:function(e,t){return t=" "+t+" ",-1!==(" "+e.className.replace(/[\t\r\n]/g," ")+" ").indexOf(t)}}):null}),n("core/dom",["core/sprite","core/system","utils/dom-utils"],function(e,t,n,i){function r(t,n){for(var i,r,o,s=t.childNodes,a=0,u=n.length;u>a;++a)switch(i=n[a],r=s[a].style,r.left=i[1]+"px",r.top=i[2]+"px",r.zIndex=i[3],r.opacity=i[4],i[0]){case 0:r.width=i[5]+"px",r.height=i[6]+"px",r.backgroundColor=i[7],r.borderColor=i[8],r.borderWidth=i[9]+"px",r.borderStyle=i[10];break;case 1:o=e(i[5]),r.backgroundPosition=-(i[6]>>0)*o.width+"px "+-o.top+"px";break;case 2:r.color=i[5],r.fontSize=i[6]+"px";break;case 3:r.width=i[5]+"px",r.height=i[6]+"px"}}var o,s,a,u,c,l=["st","br","vsbr"],h=[],d=[],f={z:0,alpha:1,color:"#000",rectangle:function(e,t,n,r,a){o.push('<div class="Grape-e"></div>'),a?s.push([0,e,t,a.z===i?f.z:a.z,a.alpha===i?f.alpha:a.alpha,n,r,a.backgroundColor===i?f.color:a.backgroundColor,a.borderColor===i?f.color:a.borderColor,a.borderWidth===i?1:a.borderWidth,a.borderStyle===i?"solid":a.borderStyle]):s.push([0,e,t,f.z,f.alpha,n,r,f.color])},sprite:function(e,t,n,r,a){o.push('<div class="Grape-e Gs-'+n+'"></div>'),a?s.push([1,e,t,a.z===i?f.z:a.z,a.alpha===i?f.alpha:a.alpha,n,r]):s.push([1,e,t,f.z,f.alpha,n,r])},text:function(e,t,n,r){o.push('<div class="Grape-e">'+n+"</div>"),r?s.push([2,e,t,r.z===i?f.z:r.z,r.alpha===i?f.alpha:r.alpha,r.color===i?f.color:r.color,r.size===i?20:r.size]):s.push([2,e,t,f.z,f.alpha,f.color,20])},background:function(e,t,n,r,a,u){o.push('<div class="Grape-e Gs-'+a+'"></div>'),u?s.push([3,e,t,u.z===i?f.z:u.z,u.alpha===i?f.alpha:u.alpha,n,r]):s.push([3,e,t,f.z,f.alpha,n,r])}};return{Protected:{init:function(){t.bind("resourceProcessed.sprite",function(e){d.push(n.createStyle(".Gs-"+e.name+"{width:"+e.width+"px; height:"+e.height+"px;"+" margin-left:"+-e.originX+"px; margin-top:"+-e.originY+"px;"+"background-image:url('"+e.url+"');}\n"))})},clearViewElements:function(){c=[]},createViewElement:function(e,t){for(var n,i=[],r=0;3>r;++r)n=document.createElement("div"),n.className="Grape-view-"+l[r],t.appendChild(n),i[r]=n;c[e]=i},beforeCollect:function(){o=[],s=[]},afterCollect:function(){h=[o,s]},beforeCollectViews:function(){u=[]},beforeCollectView:function(){o=[],s=[]},afterCollectView:function(e){u[e]=[o,s]},afterRecalculate:function(e,t){for(var n,i=0;3>i;++i)n=c[e][i].style,n.left=t.calculated.originX-t.x+"px",n.top=t.calculated.originY-t.y+"px"},renderFirstAutoRendered:function(e){var t=c[e][1];t.innerHTML=a=h[0].join(""),r(t,h[1])},renderOtherAutoRendered:function(e){c[e][1].innerHTML=a,r(c[e][1],h[1])},renderView:function(e){c[e][2].innerHTML=u[e][0].join(""),r(c[e][2],u[e][1])}},Public:f}}),n("utils/ajax",[],function(){return function(e,t){"function"==typeof t&&(t={success:t}),t=t||{},t.async===void 0&&(t.async=!0);var n;n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),n.async=t.async,n.onreadystatechange=function(){4===n.readyState&&200===n.status&&t.success&&("blob"===n.responseType||"arraybuffer"===n.responseType?t.success(n.response):t.success(n.responseText))},n.open("GET",e,t.async),t.responseType!==void 0&&(n.responseType=t.responseType),n.send()}}),n("utils/json",[],function(){return"object"==typeof JSON?JSON:{parse:function(e){return Function("","return "+e)()},stringify:function(){throw"Unsupported!"}}}),n("core/scene",["core/loader","utils/ajax","utils/environment","utils/extend","utils/json","utils/trim","utils/unique-generator"],function(e,n,i,r,o,s,a,u){function c(t,n,i){var r,o;if(i===u)return c(t,[],n);for("string"==typeof n&&(n=n.split(",")),r=0,o=n.length;o>r;++r)n[r]=s(n[r]);return"string"==typeof i&&(i={url:i},e.add("scene",i.url,i)),i.inherited=n,t||(t=d()),h[t]=i,t}function l(e,t){r(e,t)}var h={},d=a.create("anonymus-scene"),f=function(){return i.browser?function(e,t){n(e,function(e){t(o.parse(e))})}:function(e,n){var i=t("fs");i.readFile(e,function(e,t){n(o.parse(t))})}}();return e.register("scene",f,l),c.get=function(e){return h[e]},c}),n("utils/doubly-linked-list",[],function(){var e=function(){this.first=[null,null,null],this.last=[this.first,null,null],this.first[2]=this.last},t=e.detachElement=function(e){var t,n;(t=e[0])[2]=n=e[2],n[0]=t},n=e.Iterator=function(e){return{hasNext:function(){return null!==e[2][1]},next:function(){return(e=e[2])[1]},remove:function(){t(e)}}};return e.prototype={push:function(e){var t=this.last,n=t[0];return e=[n,e,t],n[2]=e,t[0]=e},pushListElement:function(e){var t=this.last;e[0]=t[0],e[2]=t,t[0][2]=e,t[0]=e},iterator:function(){return new n(this.first)},each:function(e){for(var t,n=this.iterator();null!==(t=n.next());)e.call(t,t)}},e}),n("core/playground",["core/component","core/logger","core/scene","core/system","utils/doubly-linked-list","utils/extend","utils/format","utils/has-prop"],function(e,t,n,i,r,o,s,a){var u,c,l,h,d='Scene "%1" not found!',f='Inherited scene "%1" not found!',p='Scene "%1" not loaded!',g="Next scene is not defined for the current scene!",m="Cannot call previousScene on first scene.",v=r.detachElement,y=function(e,i){var r,o,u,c;for(r=0,o=i.length;o>r;++r){u=n.get(i[r]),u||t.error(s(f,i[r])),u.inherited||t.error(s(p,i[r])),y(e,u.inherited);for(c in u)if(a(u,c))switch(c){case"inherited":break;case"init":case"instances":case"systems":e[c]=e[c].concat(u[c]);break;default:e[c]=u[c]}}},w=function(t){var n,s=function(){o(this,{fps:30,width:100,height:100,backgroundColor:"gray",background:"",backgroundAlpha:1,next:"",init:[],instances:[],systems:[],views:[{}]}),this.setViews(this.views),delete this.systems,delete this.views,y(this,[t]),this.name=t},u=function(t,n,i){var o,s,a,u,c,l,h,d=e.get(t);if(o=A[t])++x[t];else{for(o=A[t]=new r,s=E[t]=[],u=d.prototype.Component.eventNames,l=u.length;--l>=0;)h=u[l],S[h]||(S[h]=new r),s.push(S[h].push(t));if(0!==x[t])for(c=d.prototype.Component.inherited,l=c.length;--l>=0;)h=c[l],C[h]?C[h].push(t):C[h]=[t];x[t]=1}return++b,a=new d,a.x=n,a.y=i,a._id=++m,a._listElement=o.push(a),a},c=function(e){var t,n,i,r,o=e.Component.name,s=1===x[o];if(!e._destroyed){if(e._destroyed=!0,e.dispatch("destroy",s),v(e._listElement),e._localEvents)for(t in n=e._localEvents)a(n,t)&&(i=n[t].subscribe)&&v(i);if(s)for(delete A[o],r=E[o],delete E[o],t=r.length;--t>=0;)v(r[t]);--x[o],--b}},l=function(e,t){var n;return(n=_[t])||(n=_[t]=new r),n.push(e)},h=function(){var e,t,i,r=[];for(e=0,t=n.instances.length;t>e;++e)i=n.instances[e],"string"==typeof i&&(i=i.split(","),i={x:parseFloat(i[0]),y:parseFloat(i[1]),type:i[2]}),r.push(u(i.type,i.x,i.y));for(delete n.instances,e=0,t=r.length;t>e;++e)r[e].dispatch("create");for(e=0,t=n.init.length;t>e;++e)n.init[e].call(this)},d=function(){return w},f=function(e){return C[e]},p=function(e){return A[e]},g=function(){return A},m=0,w=[],b=0,x={},C={},S={},E={},_={},A={};return s.prototype={dispatch:function(e,t){var n,i,r,o,s,a=S[e];if(a)for(n=a.first;null!==(n=n[2])&&null!==(i=n[1]);)for(r=A[i].first;null!==(r=r[2])&&null!==(o=r[1]);)o.dispatch(e,t);if(s=_[e])for(r=s.first;null!==(r=r[2])&&null!==(o=r[1]);)o.dispatch(e,t)},getView:function(e){return w[e]},setViews:function(e){var t;for(t=e.length;--t>=0;)w[t]={left:0,top:0,width:"100%",height:"100%",x:0,y:0,originX:0,originY:0,zoom:1,alpha:1,follow:"",followType:"",followSpeed:"",autoRender:!0},o(w[t],e[t]),w[t].id=t;i.dispatch("viewsChanged",w)}},n=new s,{playground:n,getViews:d,finish:h,getDerivedTypes:f,getInstancesByTypes:p,getTypes:g,remove:c,subscribe:l,registerInstance:u,name:n.name}},b=[],x=function(){b.push(arguments)},C=function(){u.dispatch!==x&&(h=u.dispatch,u.dispatch=x)},S=function(){var e,t;if(u.dispatch===x){for(u.dispatch=h,e=0,t=b.length;t>e;++e)h.apply(this,b[e]);b=[]}},E=function(e){n.get(e)||t.error(s(d,e)),i.dispatch("stopLoop",function(){var t=w(e);u&&(c=l.name),u=t.playground,l=t,i.dispatch("newPlayground",u),l.finish(),i.dispatch("startLoop")})};return e.fn.destroy=function(){l.remove(this)},e.fn._subscribe=function(e){return this._id?l.subscribe(this,e):null},e.fn._unsubscribe=function(e){null!==e&&v(e)},i.bind("beginFrame",function(){u.dispatch("beginFrame")}),i.bind("frame",function(){u.dispatch("frame")}),i.bind("endFrame",function(){u.dispatch("endFrame")}),{dispatch:function(e,t){u.dispatch(e,t)},startScene:E,restartScene:function(){E(l.name)},nextScene:function(){u.next||t.error(g),E(u.next)},previousScene:function(){c||t.error(m),E(c)},getViews:function(){return l.getViews()},getDerivedTypes:function(e){return l.getDerivedTypes(e)},getInstancesByTypes:function(e){return l.getInstancesByTypes(e)},getTypes:function(){return l.getTypes()},createInstance:function(e,t,n){var i=l.registerInstance(n,e,t);return i.dispatch("create"),i},getView:function(e){return u.getView(e)},setViews:function(e){u.setViews(e)},startDeferringEvents:C,stopDeferringEvents:S}}),n("core/draw",["core/canvas","core/component","core/dom","core/logger","core/playground","core/settings","core/system","utils/dom-utils","utils/environment","utils/format"],function(e,t,n,i,r,o,s,a,u,c){function l(e){for(var t,n,i,r,o,a,u=0,c=e.length,l=h.childNodes,d=h.offsetWidth,f=h.offsetHeight;c>u;++u){for(t=l[u].style,n=e[u],i=0;6>i;++i)r=g[i],"function"!=typeof(o=n[r])&&(n[r]=parseFloat(o)+""==o+""?Function("return "+o+";"):Function("p","return "+o.replace(/%/,"/100*p")+";"));(a=n.calculated)||(a=n.calculated={}),a.left=n.left(d),a.top=n.top(f),a.width=n.width(d)/n.zoom,a.height=n.height(f)/n.zoom,a.originX=n.originX(a.width),a.originY=n.originY(a.height),t.zoom=n.zoom,t.opacity=n.alpha,""!==t.webkitTransform?(t.MozTransform="translate("+a.width/2*(n.zoom-1)+"px, "+a.height/2*(n.zoom-1)+"px) scale("+n.zoom+")",t.OTransform="translate("+a.width/2*(n.zoom-1)+"px, "+a.height/2*(n.zoom-1)+"px) scale("+n.zoom+")",t.left=a.left+"px",t.top=a.top+"px"):(t.left=a.left/n.zoom+"px",t.top=a.top/n.zoom+"px"),t.width=a.width+"px",t.height=a.height+"px",v.afterRecalculate(u,n)}s.dispatch("recalculateViews",e)}var h,d,f='Game container "%1" is missing!',p=".Grape-screen{cursor:default; z-index:0; float:left; position:relative; overflow:hidden; width:100%; height:100%;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none; text-transform:none;}.Grape-e, .Grape-view>*{position:absolute; white-space:nowrap;}.Grape-view{z-index:0; float: left;position: absolute;overflow: hidden;}",g=["left","top","width","height","originX","originY"],m=u.canvas?e:n,v=m.Protected,y=m.Public,w=u.browser?window.document:null;return v.init(),s.bind("init",function(){var e,t=o.container;if(u.browser&&!o.headless){if("string"==typeof t&&(e=w.getElementById(t)),!e)return i.error(c(f,t)),void 0;h=w.createElement("div"),h.className="Grape-screen",e.appendChild(h),h.onselectstart=function(){return!1},d=a.createStyle(p)}}),s.bind("viewsChanged",function(e){var t,n=0,i=e.length;for(h.innerHTML="",v.clearViewElements();i>n;++n)t=w.createElement("div"),t.className="Grape-view",v.createViewElement(n,t),h.appendChild(t);l(e)}),s.bind("render",function(){var e,t,n=r.getViews(),i=n.length,o=null,s=r.playground,a={alpha:s.backgroundAlpha,z:-1e7};for(v.beforeCollect(),s.background?y.background(0,0,s.width,s.height,s.background,a):s.backgroundColor&&(a.backgroundColor=s.backgroundColor,a.borderWidth=0,y.rectangle(0,0,s.width,s.height,a)),s.dispatch("draw"),v.afterCollect(),v.beforeCollectViews(),e=0;i>e;++e)v.beforeCollectView(e),s.dispatch("drawView",n[e]),s.dispatch("drawView."+e,n[e]),v.afterCollectView(e);for(l(n),(t=h.parentNode).removeChild(h),e=0;i>e;++e)n[e].autoRender&&(null===o?v.renderFirstAutoRendered(e):v.renderOtherAutoRendered(e)),v.renderView(e);t.appendChild(h)}),{Public:y,Protected:{getScreen:function(){return h},setCursor:function(e){h.style.cursor=e}}}}),n("core/gameloop",["core/playground","core/settings","core/system","utils/environment"],function(e,t,n,i){var r,o,s=null,a=!1,u=function(e){this.callback=e},c=i.browser?window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||window.setTimeout:setTimeout,l=i.browser?window.cancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.clearTimeout:clearTimeout,h=function(){var t=1e3/e.playground.fps,i=0;s=null;try{for(e.stopDeferringEvents();(new Date).getTime()>o;){if(!(16>t*i)){o=(new Date).getTime();break}n.frame(),++i,o+=t}i&&n.dispatch("render")}catch(r){if(r instanceof u)return setTimeout(r.callback,0),a=!1,void 0;throw a=!1,r}s=c(h,0),e.startDeferringEvents()},d=function(){a=!0,o=(new Date).getTime(),s=setTimeout(h,0)},f=function(t){if(t=t||function(){},!a)return t(),void 0;if(null===s)throw new u(t);l(s),s=null,e.stopDeferringEvents(),a=!1,t()},p=function(){e.startScene(r=t.scene)};return n.bind("start",p),n.bind("stopLoop",f),n.bind("startLoop",d),{restartGame:function(){f(p)}}}),n("core/input",["core/draw","core/playground","core/settings","core/system","utils/dom-utils","utils/environment","utils/has-prop"],function(e,t,n,i,r,o,s){var a,u,c={},l={},h={},d={},f={x:0,y:0,screen:{x:0,y:0},view:null,views:[],lastView:0},p={any:"any",none:"none",mouse1:"mouseLeft",mouse2:"mouseMiddle",mouse3:"mouseRight",8:"backspace",9:"tab",12:"clear",13:"enter",16:"lshift",17:"ctrl",18:"alt",19:"pause",20:"rshift",27:"esc",32:"space",33:"pagegup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",91:"windows",93:"contextmenu",106:"*",107:"+",109:"-",110:".",111:"/",144:"numlock",186:"é",187:"ó",188:",",189:"/",190:".",191:"ü",192:"ö",219:"ő",220:"ű",221:"ú",222:"á",226:"í"},g=function(e,t){var n;if("any"===e||"none"===e){for(n in t)if(s(t,n))return"any"===e;return"none"===e}return s(t,d[e])},m=function(e){var t,i=n.reservedKeys;for(t=i.length;--t>=0;)if(i[t]===e)return!0;return!1},v=function(e,n){var i=0;for(var r in e)s(e,r)&&(0===i&&t.dispatch(n+".any",r),++i,t.dispatch(n+"."+p[r]));0===i&&t.dispatch(n+".none")},y=function(){l={},h={},c={}},w=function(){var e,t;if(a){for(f.views=[],e=a.length;--e>=0;)t=a[e],f.views[e]={x:(f.screen.x-t.calculated.left)/t.zoom+t.x-t.calculated.originX,y:(f.screen.y-t.calculated.top)/t.zoom+t.y-t.calculated.originY};e=f.views[f.lastView],f.x=e.x,f.y=e.y}};for(n.reservedKeys=n.reservedKeys||[],u=65;90>=u;++u)p[u]=String.fromCharCode(u).toLowerCase();for(u=0;9>=u;++u)p[u+48]=u;for(u=0;9>=u;++u)p[u+96]="num"+u;for(u=1;12>=u;++u)p[u+111]="f"+u;for(u in p)d[p[u]]=u;return i.bind("init",function(){o.browser&&!n.headless&&(r.bind(document,"keydown",function(e){var t=r.getKeyCode(e);c[t]||(l[t]=!0),c[t]=!0,(m("any")||m(p[t]))&&r.preventDefault(e)}),r.bind(document,"keyup",function(e){var t=r.getKeyCode(e);s(c,t)&&(delete c[t],h[t]=!0)}),document.oncontextmenu=function(t){r.contains(e.Protected.getScreen(),r.getTarget(t))&&r.preventDefault(t)},r.bind(document,"mousedown",function(t){var n=e.Protected.getScreen(),i=r.getTarget(t);if(n===i||r.contains(n,i)){var o="mouse"+r.getKeyCode(t);s(c,o)||(l[o]=!0),c[o]=!0,r.preventDefault(t)}}),r.bind(document,"mouseup",function(e){var t="mouse"+r.getKeyCode(e);s(c,t)&&(delete c[t],h[t]=!0)}),r.bind(document,"mousemove",function(t){var n=r.getTarget(t),i=e.Protected.getScreen();for(t=r.getRealEvent(t),f.view=null;;){if(n===window.document)break;if(r.hasClass(n,"Grape-view")){for(u=0;null!==n.previousSibling;)n=n.previousSibling,++u;f.view=f.lastView=u;break}n=n.parentNode}f.screen.x=t.pageX-i.offsetLeft,f.screen.y=t.pageY-i.offsetTop,w()}))}),i.bind("recalculateViews",function(e){a=e,w()}),i.bind("handleInput",function(){v(l,"keyPress"),v(c,"keyDown"),v(h,"keyRelease"),l={},h={}}),{Mouse:f,resetKeys:y,alert:function(e){alert(e),y()},isPressed:function(e){return g(e,l)},isReleased:function(e){return g(e,h)},isDown:function(e){return g(e,c)}}}),n("core/select",["core/logger","core/playground","utils/extend","utils/format","utils/has-prop","utils/trim"],function(e,t,n,i,r,o,s){function a(){}function u(e){var t,n,i,r,s,a=e.split(","),u=[];for(t=0,n=a.length;n>t;++t)s=a[t]=o(a[t]),r=s.split(" "),i=r[0],r.shift(),u.push({from:i,where:r});return u}function c(e){var n,i,a,u,c,l,h=e.from,d={},f=[];if("string"==typeof h)for(h=h.split(","),n=0,i=h.length;i>n;++n)h[n]=o(h[n]);else h=e;for(n=0,i=h.length;i>n;++n)if(c=h[n],'"'===c[0]||"'"===c[0])f.push(c.substring(1,c.length-1));else if("*"===c){l=t.getTypes();for(a in l)r(l,a)&&f.push(a)}else{if(f.push(c),(l=t.getDerivedTypes(c))===s)continue;for(a=0,u=l.length;u>a;++a)d[l[a]]||(d[l[a]]=!0,f.push(l[a]))}return f}function l(e){var t,n,i;if(e===s)return[];for(e=e instanceof Array?e.slice():[e],t=0,n=e.length;n>t;++t)i=e[t],"string"==typeof i&&(i='"'===i[0]||"'"===i[0]?function(e){return function(){return this.Component.name===e}}(i.substring(1,i.length-1)):function(e){return function(){return this.Component.name===e||this.Component.inheritedSet[e]===!0}}(i),e[t]=i);return e}function h(e,t){var n,i;for(n=0,i=t.length;i>n;++n)if(!t[n].call(e))return!1;return!0}function d(e,n){var i,r,o,d,f,p,g,m,v,y,w={},b={},x=new a;for(e||(e="*"),"string"==typeof e?e=u(e):e instanceof Array||(e=[e]),i=0,r=e.length;r>i;++i)if(o=e[i],d=c(o),0!==(m=d.length))for(p=l(o.where),g=0;m>g;++g)if(!b[d[g]]){if(f=t.getInstancesByTypes(d[g]),f===s)continue;for(f=f.first;null!==(f=f[2])&&null!==(v=f[1]);)if(!w[y=v._id]&&h(v,p)&&(w[y]=!0,x.push(v),n&&0===--n))return x;0===p.length&&(b[d[g]]=!0)}return x}function f(e){return d(e,1)[0]}var p='Call undefined function "%1"';return d.fn=a.prototype=[],n(a.prototype,{filter:function(e){for(var t,n=0,i=this.length,r=new a;i>n;++n)e.call(t=this[n],n,t)&&r.push(t);return r},call:function(t){for(var n,r,o=Array.prototype.slice.call(arguments,1),a=0,u=this.length;u>a;++a)(r=this[a][t])===s&&e.error(i(p,t)),n=r.apply(this[a],o);return n},isEmpty:function(){return 0===this.length},each:function(e){for(var t,n=0,i=this.length;i>n&&e.call(t=this[n],n,t)!==!1;++n);return this},attr:function(e,t){var n=0,i=this.length;if(1===arguments.length)return this[0]===s?s:this[0][e];for(;i>n;++n)this[n][e]=t;return this},eq:function(e){var t=new a;return this[e]&&t.push(this[e]),t},get:function(e){return this[e]},one:function(){return this[0]},size:function(){return this.length},bind:function(e,t){for(var n=0,i=this.length;i>n;++n)this[n].bind(e,t);return this},unbind:function(e,t){for(var n=0,i=this.length;i>n;++n)this[n].unbind(e,t);return this},dispatch:function(e,t){for(var n=0,i=this.length;i>n;++n)this[n].dispatch(e,t);return this},destroy:function(){for(var e=0,t=this.length;t>e;++e)this[e].destroy();return this},empty:function(){return new a}}),{select:d,selectOne:f}}),n("core/position",["core/select","core/playground"],function(e){function t(e,t){return!n(e,t,"*")}function n(e,t,n){return 0!==i(e,t,n).length}function i(t,n,i){return e(i).filter(function(){return this.x===t&&this.y===n})}return e=e.select,{isFree:t,isAt:n,instancesAt:i}}),n("core/sound",["core/logger","core/loader","utils/ajax","utils/environment","utils/extend","utils/format","utils/unique-generator"],function(e,t,n,i,r,o,s){function a(n,i,s,u,l){var d,g=null,m=0,v=[s,u,l],y=v.length;if(1===arguments.length)return h[n];if("string"==typeof i)return a(n,{},i,s,u);for(n||(n=f());y>m;++m)if(v[m]&&p[v[m].substring(v[m].length-3)]){g=v[m];break}return null===g&&e.warning(o(c,n)),d={preloadAll:!0},r(d,{url:g}),h[n]=d,null!==g&&t.add("sound",(d.preloadAll?"1":"0")+"\n"+g,d),n}var u="Failed to load sound from URL: %1",c='Sound "%1" cannot be load, because there is no supported file format defined.',l='Sound "%1" is not defined.',h={},d=i.webAudio?new webkitAudioContext:null,f=s.create("anonymus-sound"),p=function(){var e,t,n,r,o,s,a;if(i.audio){for(e=["mp3","wav","ogg"],t=["audio/mpeg",'audio/wav; codecs="1"','audio/ogg; codecs="vorbis"'],s=new Audio,o={},n=0,r=e.length;r>n;++n)a=s.canPlayType(t[n]),("maybe"===a||"probably"===a)&&(o[e[n]]=!0);return o}return{}}(),g=null===d||"file:"===window.location.protocol?function(t){var n=h[t];if(!n)return e.error(o(l,t)),null;if("undefined"==typeof Media)return"undefined"!=typeof Audio?(n=new Audio(n.url),n.play(),n):null;var i="/android_asset/www/"+n.url,r=new Media(i,function(){r.release()},function(t){e.warning(JSON.stringify(t))});r.play()}:function(t){var n;return t=h[t],t?(n=d.createBufferSource(),n.buffer=t.buffer,n.connect(d.destination),n.noteOn(0),n):(e.error(o(l,t)),null)
},m=i.browser?function(t,i){if("file:"===window.location.protocol)i();else if(t=t.split("\n"),"1"===t[0])n(t[1],{responseType:"arraybuffer",success:function(e){d?d.decodeAudioData(e,function(e){i(e)}):i(e)}});else{var r=new Audio;r.addEventListener("canplaythrough",function(){i(r)},!1),r.addEventListener("error",function(){e.error(o(u,t))},!1),r.src=t[1]}}:function(e,t){t()};return t.register("sound",m,function(e,t){e.buffer=t}),{sound:a,playSound:g}}),n("core/tile",["core/sprite","utils/has-prop"],function(e,t){return function(n,i,r,o){var s;for(var a in o)t(o,a)&&(s=o[a][3],e(a,r,{width:n*(s||1),height:i,rightBounding:n,bottomBounding:i,left:o[a][0]*n,top:o[a][1]*i,subimages:o[a][2]}))}}),n("core/main",["core/component","core/draw","core/gameloop","core/input","core/loader","core/logger","core/playground","core/position","core/scene","core/select","core/settings","core/sound","core/sprite","core/system","core/tile"],function(e,t,n,i,r,o,s,a,u,c,l,h,d,f,p){var g=c.select;return f.bind("newPlayground",function(e){s.playground=g.playground=e}),g.component=g.c=e,g.Draw=t.Public,g.setCursor=t.Protected.setCursor,g.restartGame=n.restartGame,g.Input=i,g.alert=i.alert,g.Mouse=i.Mouse,g.Loader=r,g.Logger=o,g.startScene=s.startScene,g.restartScene=s.restartScene,g.nextScene=s.nextScene,g.previousScene=s.previousScene,g.createInstance=g.i=s.createInstance,g.dispatch=s.dispatch,g.getView=s.getView,g.setViews=s.setViews,g.isFree=a.isFree,g.isAt=a.isAt,g.instancesAt=a.instancesAt,g.scene=u,g.select=c.select,g.selectOne=c.selectOne,g.Settings=l,g.sound=h.sound,g.playSound=h.playSound,g.sprite=d,g.start=f.start,g.tile=p,g}),n("std/misc",["core/component","core/input","core/playground","utils/has-prop"],function(e,t,n,i,r){var o=function(e){var n=e.getBounds();t.Mouse.x>=n.left&&t.Mouse.x<n.right&&t.Mouse.y>=n.top&&t.Mouse.y<n.bottom?e._mouseOver||(e._mouseOver=!0,e.dispatch("mouseOver")):e._mouseOver&&(e._mouseOver=!1,e.dispatch("mouseOut"))};e("Size",{},{getLeft:function(){return this.x},getTop:function(){return this.y}},{getWidth:!0,getHeight:!0,getBounds:!0}),e("Mouse","Size",{create:function(){o(this)},frame:function(){o(this)},keyPress:{mouseLeft:function(){this._mouseOver&&this.dispatch("localPress.mouseLeft")},mouseRight:function(){this._mouseOver&&this.dispatch("localPress.mouseRight")}},keyRelease:{mouseLeft:function(){this._mouseOver&&this.dispatch("localRelease.mouseLeft")},mouseRight:function(){this._mouseOver&&this.dispatch("localRelease.mouseRight")}},keyDown:{mouseLeft:function(){this._mouseOver&&this.dispatch("localDown.mouseLeft")},mouseRight:function(){this._mouseOver&&this.dispatch("localDown.mouseRight")}}},{isMouseOver:function(){return this._mouseOver},isMouseOverInView:function(e){return t.Mouse.view===e&&this._mouseOver}},{isMouseOver:!1,isMouseOverInView:!1,getWidth:!0,getHeight:!0,getBounds:!0}),e("Alarm",{create:function(){this._alarms={}},frame:function(){var e;for(e in this._alarms)i(this._alarms,e)&&0>=--this._alarms[e]&&(delete this._alarms[e],this.dispatch("alarm",e),this.dispatch("alarm."+e))}},{setAlarm:function(e,t){this._alarms[e]=t},getAlarm:function(e){return this._alarms[e]},increaseAlarm:function(e,t){this._alarms[e]?this._alarms[e]+=t:this._alarms[e]=t},hasAlarm:function(e){return this._alarms[e]!==r}},{setAlarm:!1,getAlarm:!1,increaseAlarm:!1,hasAlarm:!1}),e("Outside","Size",{frame:function(){var e=this.isOutside();null!==e&&this.dispatch("outside",e)}},{teleport:function(e){var t=n.playground,i=this.getWidth(),r=this.getHeight();switch(e){case"left":this.x+=i+t.width;break;case"right":this.x-=i+t.width;break;case"top":this.y+=r+t.height;break;case"bottom":this.y-=r+t.height}},isOutside:function(e,t,i,o){var s=this.getWidth(),a=this.getHeight();return e===r?(e=this.x,t=this.y):i&&(e+=this.x,t+=this.y),o?0>e?"left":0>t?"top":e+s>n.playground.width?"right":t+a>n.playground.height?"bottom":null:0>=e+s?"left":0>=t+a?"top":e>n.playground.width?"right":t>n.playground.height?"bottom":null},stickingOut:function(e,t,n){return this.isOutside(e,t,n,!0)}},{getWidth:!0,getHeight:!0,getBounds:!0})}),n("std/collidable",["core/component","core/playground","core/system","std/misc","utils/has-prop"],function(e,t,n,i,r){var o,s={},a=64,u=function(e,t){return e[1]>=t[0]&&t[1]>=e[0]&&e[3]>=t[2]&&t[3]>=e[2]},c=function(e,t){var n,i,c,l,h,d,f,p,g,m=[t.left,t.right,t.top,t.bottom],v=t.left/a>>0,y=t.right/a>>0,w=t.top/a>>0,b=t.bottom/a>>0,x={},C=e._id;for(n=v;y>=n;++n)for(i=w;b>=i;++i)if(l=o[c=n+";"+i]){for(h=l.length;--h>=0;)d=l[h],u(m,d[2])&&(x[d[1]]=d[0]);l.push([e,C,m])}else o[c]=l=[[e,e._id,m]];for(n in x)if(r(x,n)){for(f=x[n],p=f.Component.inheritedAndMe,i=0,g=p.length;g>i&&!s[n]&&!s[C];++i)e.dispatch("collision."+p[i],f);for(p=e.Component.inheritedAndMe,i=0,g=p.length;g>i&&!s[n]&&!s[C];++i)f.dispatch("collision."+p[i],e)}};n.bind("collision",function(){o={},s={},t.dispatch("collisionCheck")}),e("Collidable","Size",{collisionCheck:function(){c(this,this.getBounds())},destroy:function(){s[this._id]=1}},{},{getWidth:!0,getHeight:!0,getBounds:!0})}),n("std/physical",["core/component","core/playground","core/system"],function(e,t,n){n.bind("physics",function(){t.dispatch("physics")});var i={left:180,right:0,up:90,down:270};e("Physical",{create:function(){this.vspeed=this.hspeed=this.vacc=this.hacc=this.friction=0},physics:function(){this.hspeed+=this.hacc,this.vspeed+=this.vacc;var e=this.getSpeed()-this.friction;this.setSpeed(e>0?e:0),this.x+=this.hspeed,this.y+=this.vspeed}},{getSpeed:function(){return Math.sqrt(this.vspeed*this.vspeed+this.hspeed*this.hspeed)},setSpeed:function(e){var t=this.getSpeed();return 0!==t?(this.vspeed*=e/t,this.hspeed*=e/t):this.hspeed=e,this},setDirection:function(e){if("string"==typeof e)this.setDirection(i[e]||0);else{e%=360;var t=this.getSpeed();this.vspeed=-Math.sin(e/180*Math.PI)*t,this.hspeed=Math.cos(e/180*Math.PI)*t}return this},getDirection:function(){return(180*(Math.atan2(this.hspeed,this.vspeed)/Math.PI)+270)%360},accelerate:function(e){var t=this.getSpeed();return 0!==t?(this.vspeed*=(t+e)/t,this.hspeed*=(t+e)/t):this.setSpeed(e),this},stop:function(){return this.vspeed=this.hspeed=0,this},moveTo:function(e,t,n){void 0===n&&(n=this.getSpeed()),this.hspeed=e-this.x,this.vspeed=t-this.y,this.setSpeed(n)},bounceAgainst:function(e){var t,n;t=this.inherits("Size")?this.getBounds():{left:this.x,right:this.x},n=e.inherits("Size")?e.getBounds():{left:e.x,right:e.x};var i=t.right<n.right?t.right:n.right,r=t.left>n.left?t.left:n.left,o=t.bottom<n.bottom?t.bottom:n.bottom,s=t.top>n.top?t.top:n.top;o-s>i-r?this.hspeed*=-1:this.vspeed*=-1},reverse:function(e){switch(e){case"left":case"right":this.hspeed*=-1;break;default:this.vspeed*=-1}}})}),n("std/rendering",["core/component","core/draw","core/sprite","std/misc"],function(e,t,n){t=t.Public,e("Renderable",{},{},{render:!0}),e("AutoRendered","Renderable",{create:function(){this.z=0,this.alpha=1,this.visible=!0},draw:function(){this.visible&&(t.z=this.z,t.alpha=this.alpha,this.render())}},{},{render:!0}),e("Sprite","Renderable,Size",{create:function(){this.sprite=null,this.subimage=0}},{getSprite:function(){return n(this.sprite)},getLeft:function(){var e=this.getSprite();return this.x-e.originX+e.leftBounding},getTop:function(){var e=this.getSprite();return this.x-e.originY+e.topBounding},getWidth:function(){var e=this.getSprite();return e.rightBounding-e.leftBounding},getHeight:function(){var e=this.getSprite();return e.bottomBounding-e.topBounding},getBounds:function(){if(!this.sprite)return{left:this.x,top:this.y,right:this.x,bottom:this.y};var e=this.getSprite(),t=this.x-e.originX,n=this.y-e.originY;return{left:t+e.leftBounding,top:n+e.topBounding,right:t+e.rightBounding,bottom:n+e.bottomBounding}},render:function(){t.sprite(this.x,this.y,this.sprite,this.subimage)}},{getSprite:!1}),e("Animated","Sprite",{create:function(){this.imageSpeed=1},frame:function(){var e=this.getSprite().subimages,t=this.subimage+this.imageSpeed;t>=e?(this.subimage=t%e,this.dispatch("animationEnd")):this.subimage=t}}),e("Text","Renderable",{create:function(){this.text="",this.textColor="#f00",this.textSize=22}},{render:function(){t.text(this.x,this.y,this.text,{color:this.textColor,size:this.textSize})}}),e("Rectangle","Renderable,Size",{create:function(){this.width=this.height=0,this.borderWidth=1,this.backgroundColor="#fff",this.borderColor="#000"}},{getWidth:function(){return this.width},getHeight:function(){return this.height},getBounds:function(){return{left:this.x,top:this.y,right:this.x+this.width,bottom:this.y+this.height}},render:function(){t.rectangle(this.x,this.y,this.width,this.height,{backgroundColor:this.backgroundColor,borderColor:this.borderColor,borderWidth:this.borderWidth})}})}),n("std/main",["std/collidable","std/misc","std/physical","std/rendering"],function(){}),n("utils/main",["utils/ajax","utils/dom-utils","utils/doubly-linked-list","utils/environment","utils/extend","utils/format","utils/has-prop","utils/json","utils/trim"],function(e,t,n,i,r,o,s,a,u){return{ajax:e,DomUtils:t,DoublyLinkedList:n,Environment:i,extend:r,format:o,hasProp:s,JSON:a,trim:u}}),n("main",["core/main","std/main","utils/main"],function(e,i,r){return e.Utils=r,e.define=n,e.require=t,e}),n("global-namespace",["main"],function(e){var t=Function("return this")();t.Grape=e,"function"==typeof t.define&&t.define("grape",[],function(){return e})}),t("global-namespace")})("function"==typeof require?require:null);